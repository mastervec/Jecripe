var ac:AtividadeCrecheController;

var dummyOnChair:GameObject;

private var InitialPosition:Vector3;
private var grabberActive:boolean = false;

function Start()
{
	InitialPosition = this.transform.localPosition;
}

var ray : Ray;

function OnMouseDown()
{
	Debug.Log('mousedown');
	if (grabberActive)
	{
		if ( ac.ObjetoDaVez == this.name )
		{
			ac.IsDragging(true);
			//ac.setCurrentDragingObject(this.name);
			
			ray = Camera.main.ScreenPointToRay (Input.mousePosition);
			this.transform.localPosition = Camera.main.ScreenPointToRay (Input.mousePosition).GetPoint(3.8);
			
			switch ( this.name )
			{
				case "Mamadeira":
				this.transform.localPosition.x -= 0.5;
				break;
				case "Chocalho":
				this.transform.localPosition.x += 1;
				break;
				case "Chupeta":
				break;
				case "Papinha":
				break;
				
			}
			this.transform.localPosition.x += 0.5;
			this.transform.localPosition.y -= 0.3;
	//		Debug.Log(ray);
		}
		else // Se nao eh objeto da vez tocar animaçao de contrariedade e som...
		{
			ac.ActivateDindtLikedAnimation();
		}
	}
}
function OnMouseDrag()
{
	if (grabberActive)
	{
		if ( ac.ObjetoDaVez == this.name )
		{
			ray = Camera.main.ScreenPointToRay (Input.mousePosition);
			this.transform.localPosition = Camera.main.ScreenPointToRay (Input.mousePosition).GetPoint(3.8);
			switch ( this.name )
			{
				case "Mamadeira":
				this.transform.localPosition.x -= 0.5;
				break;
				case "Chocalho":
				this.transform.localPosition.x += 1;
				break;
				case "Chupeta":
				break;
				case "Papinha":
				break;
				
			}
			this.transform.localPosition.x += 0.5;
			this.transform.localPosition.y -= 0.3;
		}
	}
}

function OnMouseUp()
{
	if (grabberActive)
	{
		if ( ac.ObjetoDaVez == this.name )
		{
			ac.IsDragging(false);
			this.transform.localPosition = InitialPosition;
			var hit : RaycastHit;
			if (Physics.Raycast (Camera.main.ScreenPointToRay(Input.mousePosition).origin,Camera.main.ScreenPointToRay(Input.mousePosition).direction*10, hit)) 
			{
				if (hit.transform.name == "Bebe")
				{
					Debug.Log('SoltouCerto');
					SoltouCerto();
				}
			}
		}
	}
}

function SoltouCerto()
{
	if (grabberActive)
	{
		// Avisa para atividade controller q soltou certo objeto
		// AtividadeCrecheController faz:
			// Checa se terminou a atividade
			// Chama Animacao correta do bebe
			// Muda o objeto a ser pego
			// Starta a animaçao de apontar denovo se a atividade nao tiver completa

		//DESATIVAR A RENDERIZAÇÃO E COLISÃO ANTES DO YEILD PARA QUE O ULTIMO OBJETO NÃO FIQUE EM POSIÇÃO
		//GetComponent.<Renderer>().enable = false;
		// Faz o Objeto sumir e aparecer em cima da mesa
		dummyOnChair.SetActiveRecursively(true);
		this.transform.localPosition.x += 50;
		yield ac.ObjectDropped();	
			
		Destroy(gameObject);
	}
}

function MakeGrabberActive(_state:boolean)
{
	grabberActive = _state;
}

function Update()
{
//	Debug.Log("Mouse postition(x , y , z ): "+ Input.mousePosition);
	Debug.DrawRay(ray.origin,ray.direction*4.5, Color.green);
}